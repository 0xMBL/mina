(executable
  (name fake_hash_value_gen)
  (modules fake_hash_value_gen)
  (libraries core_kernel)
  (preprocess (pps ppx_optcomp))
  (preprocessor_deps "../../config.mlh"))

(rule
  (targets fake_hash_value)
  (deps fake_hash_value_gen)
  (action (run %{exe:fake_hash_value_gen} fake_hash_value)))

(alias
  (name fake_hash_enabled)
  (deps fake_hash_value)
  (action (run
    [ %{exe:fake_hash_value} = "true" ] || exit 1)))
;  (enabled_if (= %{read:fake_hash_value} "true")))

(library
  (name coda_digestif)
  (public_name coda_digestif)
  (modules coda_digestif)
  (libraries
    digestif
    (select digestif from
      (fake_hash_enabled -> digestif.c)
      (!fake_hash_enabled -> digestif.ocaml))))
